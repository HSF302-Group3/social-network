<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Reports Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap & FontAwesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        .post-images {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .post-images img,
        .overlay-image img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
        }

        .post-images img:hover,
        .overlay-image:hover img {
            transform: scale(1.05);
            filter: brightness(1.1);
        }

        .overlay-image {
            position: relative;
            cursor: pointer;
            border-radius: 12px;
            overflow: hidden;
        }

        .overlay-image::after {
            content: attr(data-more);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.9), rgba(118, 75, 162, 0.9));
            color: white;
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            backdrop-filter: blur(5px);
        } .pagination {
              display: flex;
              list-style: none;
              gap: 6px;
              padding-left: 0;
              justify-content: center;
              margin-top: 20px;
          }

        .pagination li a {
            padding: 6px 12px;
            border: 1px solid #ccc;
            text-decoration: none;
            color: black;
            background-color: #f1f1f1;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .pagination li.active a {
            background-color: #02CAA9;
            color: white;
            font-weight: bold;
            border-color: #02CAA9;
        }

        .pagination li.disabled a {
            pointer-events: none;
            color: #ccc;
            background-color: #eee;
            border-color: #ccc;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h2 class="mb-4">Reported Posts</h2>
    <table class="table table-bordered table-hover">
        <thead class="table-dark">
        <tr>
            <th>Reported By</th>
            <th>Reason</th>
            <th>User Create Post</th>
            <th>CreateAt</th>
            <th>Action</th>

        </tr>
        </thead>
        <tbody>
        <tr th:each="report : ${reports}">
            <td >
                <img width="50px" th:src="${report.user.avatarUrl}">
                <span th:text="${report.user.name}"></span>

            </td>
            <td th:text="${report.reason}"></td>

            <td >
                <img width="50px" th:src="${report.post.usercreate.avatarUrl}">
                <span th:text="${report.post.usercreate.name}"></span>

            </td>
            <td th:text="${report.createdAt}"></td>
            <td>
                <button class="btn btn-primary btn-sm"
                        data-bs-toggle="modal"
                        th:attr="data-bs-target='#modal__' + ${report.id}">
                    View
                </button>
            </td>
        </tr>
        </tbody>
    </table>
    <nav th:if="${paging.totalPages > 1}">
        <ul class="pagination">
            <li th:classappend="${paging.first} ? 'disabled'">
                <a th:href="@{'/reports?page='+${currentPage - 1}}">Previous</a>
            </li>

            <li th:each="i : ${#numbers.sequence(0, paging.totalPages - 1)}"
                th:classappend="${i == currentPage} ? 'active'">
                <a th:href="@{'/reports?page='+${i}}" th:text="${i + 1}"></a>
            </li>

            <li th:classappend="${paging.last} ? 'disabled'">
                <a th:href="@{'/reports?page='+${currentPage + 1}}">Next</a>
            </li>
        </ul>
    </nav>

    <!-- Modals for each report -->
    <div th:each="report : ${reports}">
        <div class="modal fade" th:id="'modal__' + ${report.id}" tabindex="-1">
            <div class="modal-dialog modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Post Detail</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p><strong>Reason:</strong> <span th:text="${report.reason}"></span></p>
                        <p><strong>Content:</strong> <span th:text="${report.post.content}"></span></p>

                        <div class="post-images" th:with="images=${report.post.imagePost}">
                            <div th:each="img, stat : ${images}">
                                <img th:if="${stat.index < 3}"
                                     th:src="${img.imageUrl}"
                                     th:attr="data-url=${img.imageUrl}, data-index=${stat.index}"
                                     class="clickable-image"
                                     alt="Post Image"/>

                                <div th:if="${stat.index == 3 and images.size() > 4}"
                                     class="overlay-image clickable-image"
                                     th:attr="data-url=${img.imageUrl}, data-index=${stat.index}, data-more='+' + ${images.size() - 4}">
                                    <img th:src="${img.imageUrl}" alt="Post Image"/>
                                </div>

                                <img th:if="${stat.index == 3 and images.size() == 4}"
                                     th:src="${img.imageUrl}"
                                     th:attr="data-url=${img.imageUrl}, data-index=${stat.index}"
                                     class="clickable-image"
                                     alt="Post Image"/>

                                <img th:if="${stat.index > 3}"
                                     th:src="${img.imageUrl}"
                                     th:attr="data-url=${img.imageUrl}, data-index=${stat.index}"
                                     style="display: none"
                                     class="clickable-image"
                                     alt="Post Image"/>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <form th:action="@{'/reports/band/'+${report.id}}" method="post">
                            <button type="submit" class="btn btn-danger"
                                    th:if="${!report.banded}">
                                Ban Post
                            </button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Optional JS to support image preview (optional) -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const modals = document.querySelectorAll('.modal');

        modals.forEach(modal => {
            const images = modal.querySelectorAll('.clickable-image');
            images.forEach(img => {
                img.addEventListener("click", () => {
                    const url = img.getAttribute("data-url");
                    window.open(url, "_blank");
                });
            });
        });
    });
</script>
</body>
</html>
